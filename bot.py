import os
from flask import Flask, request, send_file
from telegram import Update, Bot
from telegram.ext import Dispatcher, CommandHandler, MessageHandler, Filters
from io import BytesIO
from docx import Document
from docx.shared import RGBColor

# Список имён иноагентов для зачеркивания (пример)
FOREIGN_AGENT_NAMES = ["Иван Иванов", "Мария Петрова", "John Smith", "Ресурсный центр для ЛГБТ", "Босов Катерина Евгеньевна", "Общество с ограниченной ответственностью «ЕЛКИН КАРТОН»",
    "Ресурсный центр для ЛГБТ",
    "Телеканал Дождь",
    "Anti-Corruption Foundation Inc.",
    "Deutsche Welle (Германия, Kurt-Schumacher-Strasse 3, 53113 Bonn)",
    "Hidemy.network Ltd.",
    "MRR-Fund gemeinnützige UG (haftungsbeschränkt), реализующий проект My Russian Rights",
    "The Bell",
    "BILD на русском",
    "Idel.Реалии",
    "Медиазона",
    "Алексей Навальный",
    "Алексей Венедиктов",
    "Максим Кац",
    "Илья Варламов",
    "Михаил Ходорковский",
    "Григорий Чхартишвили (Борис Акунин)",
    "Юлия Латынина",
    "Александр Невзоров",
    "Евгений Чичваркин",
    "Виктор Шендерович",
    "Ольга Романова",
    "Марк Фейгин",
    "Русская служба BBC",
    "Голос Америки",
    "Радио Свобода",
    "Медиахолдинг «Медуза»",
    "Альянс врачей",
    "ОВД-Инфо",
    "Проект",
    "Настоящее Время",
    "Репаблик",
    "МБХ Медиа",
    "Агора",
    "Команда 29",
    "Правозащита Открытки",
    "Русь сидящая",
    "Апология протеста",
    "Фонд борьбы с коррупцией",
    "Фонд защиты прав граждан",
    "Алексей Горинов",
    "Иван Жданов",
    "Леонид Волков",
    "Александр Сотник",
    "Марат Гельман",
    "Ксения Ларина",
    "Гарри Каспаров",
    "Михаил Зыгарь",
    "Иван Ключарёв",
    "Андрей Лошак",
    "Павел Лобков",
    "Лилия Чанышева",
    "Сергей Смирнов",
    "Илья Яшин",
    "Олег Кашин",
    "Сергей Пархоменко",
    "Татьяна Лазарева",
    "Сергей Гуриев",
    "Константин Эггерт",
    "Сергей Алексашенко",
    "Игорь Яковенко",
    "Александр Баунов",
    "Григорий Свердлин",
    "Валерий Печейкин",
    "Юрий Дудь",
    "Роман Доброхотов",
    "Алексей Пивоваров",
    "Канал Redakciya",
    "Пётр Верзилов",
    "Надежда Толоконникова",
    "Мария Алехина",
    "Pussy Riot",
    "Оксана Баулина",
    "Артемий Троицкий",
    "Аркадий Бабченко",
    "Эхо Москвы",
    "Новая Газета",
    "Новая Газета Европа",
    "Новая История",
    "Независимая Газета",
    "Сноб",
    "Такие дела",
    "Холод",
    "iStories (Важные истории)",
    "7x7",
    "Псковская губерния",
    "Сота",
    "Альберт Михалев",
    "Татьяна Фельгенгауэр",
    "Илья Азар",
    "Светлана Прокопьева",
    "Михаил Фишман",
    "Андрей Бильжо",
    "Дмитрий Быков",
    "Дмитрий Муратов",
    "Лев Шлосберг",
    "Елена Милашина",
    "Александр Плющев",
    "Антон Орехъ",
    "Николай Картозия",
    "Ирина Шихман",
    "Наталья Синдеева",
    "Канал Дождь",
    "Канал Навальный Live",
    "Канал Популярная политика",
    "Канал Ходорковский Live",
    "Канал Русский агент",
    "Канал Кашин",
    "Канал Шрёдингер",
    "Канал Varvara",
    "Канал SHULMAN",
    "Канал Нино Росебашвили",
    "Канал Спец",
    "Канал Bild на русском",
    "Канал Версус",
    "Канал Майор и Генерал",
    "Канал Живой Гвоздь",
    "Канал Латвия24",
    "Канал ВДудь",
    "Канал Max KATZ",
    "Канал OPEN Media",
    "Канал редакция",
    "Канал ГУЛАГу.net",
    "Канал Dissernet",
    "Канал Proekt.Media",
    "Канал Conflict Intelligence Team",
    "Канал Feminist Anti-War Resistance",
    "Канал Free Russia Foundation",
    "Канал Meduza",
    "Канал OVD-Info",
    "Канал Safehouse",
    "Канал Support for Political Prisoners. Memorial",
    "Канал Team Navalny",
    "Канал Verstka",
    "Канал Волна",
    "Канал Голос Америки",
    "Канал Idel.Реалии",
    "Канал Кавказ.Реалии",
    "Канал Крым.Реалии",
    "Канал Радио Свобода",
    "Канал Сибирь.Реалии",
    "Канал Sever.Realii",
    "Канал Южная Сеть",
    "Канал Эхо",
    "Канал Эхо Москвы",
    "Канал Эхо. Новости", "Абдурахманов Тумсу Умалтович",
  "Абишев Илья Еркенович",
  "Агалакова Жанна Леонидовна",
  "Агафонова Елена Владимировна",
  "Агумава Фидель Эдуардович",
  "Адагамов Рустем Ринатович",
  "Азар Илья Вильямович",
  "Айнбиндер Александра Александровна",
  "Айсин Руслан Валерьевич",
  "Аксенов Андрей Николаевич",
  "Албуров Георгий Валентинович",
  "Александрова-Зорина Елизавета Борисовна",
  "Алексашенко Сергей Владимирович",
  "Алексеев Андрей Викторович",
  "Алексеев Иван Александрович",
  "Алесин Денис Владимирович",
  "Алешковский Дмитрий Петрович",
  "Аллеман Ирина Владимировна",
  "Альбац Евгения Марковна",
  "Андреева Мария Борисовна",
  "Анин Роман Александрович",
  "Антонов Сергей Юрьевич",
  "Апахончич Дарья Александровна",
  "Апресян Рубен Грантович",
  "Апухтина Юлия Владимировна",
  "Арапова Галина Юрьевна",
  "Артемьев Игорь Андреевич",
  "Архангельский Александр Николаевич",
  "Архипова Александра Сергеевна",
  "Арцуев Аслан Хамзатович",
  "Аршба Низфа Дарисмановна",
  "Асафьев Артур Валерьевич",
  "Аскеров Ровшан Энвер оглы",
  "Асланян Сергей Степанович",
  "Асташин Иван Игоревич",
  "Ауслендер Сергей Дмитриевич",
  "Афанасьев Андрей Андреевич",
  "Афанасьева Вера Владимировна",
  "Баблоян Ирина Арамовна",
  "Бабченко Аркадий Аркадьевич",
  "Баданин Роман Сергеевич",
  "Баев Андрей Сергеевич",
  "Бакалейко Богдан Владимирович",
  "Балтатарова Евгения Семеновна",
  "Балунов Александр Валентинович",
  "Барабанов Илья Алексеевич",
  "Барабаш Екатерина Юрьевна",
  "Барабашова Любовь Григорьевна",
  "Баранова Наталья Владимировна",
  "Барановский Алексей Александрович",
  "Барбашин Антон Игоревич",
  "Баршева Оксана Андреевна",
  "Баунов Александр Германович",
  "Бекбулатова Таисия Львовна",
  "Беленькая Марианна Борисовна",
  "Белик Александр Еленович",
  "Белковский Станислав Александрович",
  "Белокиев Ислам Русланович",
  "Белоцерковская Вероника Борисовна",
  "Белый Руслан Викторович",
  "Беляев Иван Михайлович",
  "Беляева Нина Александровна",
  "Беляков Данила Валерьевич",
  "Беньяш Михаил Михайлович",
  "Бер Илья Леонидович",
  "Березовец Тарас Валерьевич",
  "Беседина Дарья Станиславовна",
  "Биккинин Ирек Дамирович",
  "Богданова Дарья Алексеевна",
  "Бойко Сергей Андреевич",
  "Бондарев Борис Анатольевич",
  "Борзунова Мария Михайловна",
  "Боровой Константин Натанович",
  "Бортник Егор Михайлович",
  "Борухович Ирина Григорьевна",
  "Босов Катерина Евгеньевна",
  "Боссарт Алла Борисовна",
  "Бровков Артем Андреевич",
  "Буракова Анастасия Андреевна",
  "Бусыгина Ирина Марковна",
  "Быков Дмитрий Львович",
  "Ваганов Вадим Александрович",
  "Важенков Артем Валерьевич",
  "Вайпан Григорий Викторович",
  "Вайсман Анатолий Александрович",
  "Варламов Илья Александрович",
  "Вахштайн Виктор Семенович",
  "Вачагаев Майрбек Момуевич",
  "Великовский Дмитрий Александрович",
  "Веллер Михаил Иосифович",
  "Венедиктов Алексей Алексеевич",
  "Венявкин Илья Геннадиевич",
  "Верзилов Петр Юрьевич",
  "Ветошкина Валерия Валерьевна",
  "Винатье Лоран Клод Жан-Луи",
  "Вихарева Эльвира Владимировна",
  "Вишневский Борис Лазаревич",
  "Владыкина Елена Сергеевна",
  "Водвуд Вераника Сергеевна",
  "Волков Леонид Михайлович",
  "Волна Андрей Анатольевич",
  "Волобуев Игорь Михайлович",
  "Волохонский Владимир Львович",
  "Вольтская Татьяна Анатольевна",
  "Воробьев Виктор Викторович",
  "Воронов Владимир Владимирович",
  "Вотановский Виталий Викторович",
  "Вырыпаев Иван Александрович",
  "Габбасов Руслан Салаватович",
  "Габуев Александр Тамерланович",
  "Гаджиев Магомед Тажудинович",
  "Галкин Максим Александрович",
  "Галлямов Аббас Радикович",
  "Галямина Юлия Евгеньевна",
  "Ганапольский Матвей Юрьевич",
  "Ганнушкина Светлана Алексеевна",
  "Гармажапова Александра Цыреновна",
  "Гатов Василий Викторович",
  "Гельман Марат Александрович",
  "Генис Александр Александрович",
  "Герасименко Олеся Михайловна",
  "Гершензон Лев Михайлович",
  "Гималова Регина Эмилевна",
  "Гликин Максим Александрович",
  "Глуховский Дмитрий Алексеевич",
  "Гозман Леонид Яковлевич",
  "Голубева Анастасия Павловна",
  "Голубева Анна Львовна",
  "Гольдшмидт Филипп",
  "Гончаров Василий Владимирович",
  "Горалик Линор-Джулия",
  "Горбачев Александр Витальевич",
  "Гордеева Катерина Владимировна",
  "Гордон Дмитрий Ильич",
  "Горпинченко Алексей Вячеславович",
  "Гребенщиков Борис Борисович",
  "Грезев Александр Викторович",
  "Григорьев Андрей Валерьевич",
  "Григорьева Алина Александровна",
  "Грозев Христо",
  "Гройсман Софья Романовна",
  "Грязневич Наталья Владимировна",
  "Губанов Алексей Александрович",
  "Губарев Даниил Евгеньевич",
  "Губин Дмитрий Павлович",
  "Гудков Геннадий Владимирович",
  "Гудков Дмитрий Геннадьевич",
  "Гудков Лев Дмитриевич",
  "Гуляев Сергей Владимирович",
  "Гуриев Сергей Маратович",
  "Гурман Юрий Альбертович",
  "Гусев Андрей Юрьевич",
  "Гырдымова Елизавета Андреевна",
  "Давлетгильдеев Ринат Маратович",
  "Давлятчин Илья Владимирович",
  "Давыдов Дмитрий Викторович",
  "Данилович Ирина Брониславовна",
  "Дарбинян Саркис Симонович",
  "Дзугкоева Регина Николаевна",
  "Дзядко Тихон Викторович",
  "Доброхотов Роман Александрович",
  "Довданов Владимир Анатольевич",
  "Докучаев Алексей Алексеевич",
  "Долин Антон Владимирович",
  "Долинина Ирина Николаевна",
  "Доможиров Евгений Валерьевич",
  "Дорохов Владимир Юрьевич",
  "Дремин Иван Тимофеевич",
  "Дубровский Дмитрий Викторович",
  "Дудко Екатерина Артуровна",
  "Дудь Юрий Александрович",
  "Дунцова Екатерина Сергеевна",
  "Дымарский Виталий Наумович",
  "Егоров Владимир Владимирович",
  "Ежов Михаил Анатольевич",
  "Ежов Сергей Александрович",
  "Еланчик Олег Александрович",
  "Елкин Сергей Владимирович",
  "Еловский Дмитрий Сергеевич",
  "Жадаев Иван Алексеевич",
  "Жвик Анастасия Николаевна",
  "Жданов Иван Юрьевич",
  "Железнова Мария Михайловна",
  "Живица Владислав Геннадьевич",
  "Жилинский Владимир Александрович",
  "Жилкин Владимир Владимирович",
  "Жирнов Сергей Олегович",
  "Жуковский Владислав Сергеевич",
  "Затирко Андрей Викторович",
  "Захаров Андрей Вячеславович",
  "Заякин Андрей Викторович",
  "Зимин Борис Дмитриевич",
  "Зицер Вадим Семенович",
  "Зубов Андрей Борисович",
  "Зудиева Лутфие Ремзиевна",
  "Зуева Анна Сергеевна",
  "Зыгарь Михаил Викторович",
  "Иванов Дмитрий Сергеевич",
  "Иванов Павел Викторович",
  "Иванова София Юрьевна",
  "Ивлева-Йорк Виктория Марковна",
  "Ившина Ольга Яковлевна",
  "Илларионов Андрей Николаевич",
  "Илюхин Сергей Валерьевич",
  "Иноземцев Владислав Леонидович",
  "Ишутин Кирилл Валерьевич",
  "Каверзина Светлана Викторовна",
  "Кавказский Николай Юрьевич",
  "Кагарлицкий Борис Юльевич",
  "Казанцева Александра Николаевна",
  "Казанцева Анастасия Андреевна",
  "Камалягин Денис Николаевич",
  "Канкия Давид Николаевич",
  "Каныгин Павел Юрьевич",
  "Кара-Мурза Владимир Владимирович",
  "Караулов Андрей Викторович",
  "Карезина Инна Павловна",
  "Каретникова Анна Георгиевна",
  "Карпов Евгений Вячеславович",
  "Карпук Руслан Леонидович",
  "Картавин Антон Викторович",
  "Каруличева Анна Николаевна",
  "Каспаров Гарри Кимович",
  "Касьянов Михаил Михайлович",
  "Катаев Денис Сергеевич",
  "Каткова Вероника Вячеславовна",
  "Кац Максим Евгеньевич",
  "Качанов Роман Романович",
  "Качур Кирилл Витальевич",
  "Кашапов Рафис Рафаилович",
  "Кашин Олег Владимирович",
  "Кашинцев Олег Вячеславович",
  "Кен Даниил Олегович",
  "Кильтау Екатерина Викторовна",
  "Кириллов Никита Никитович",
  "Кирия Ксения Дмитриевна",
  "Кирсанов Сергей Владимирович",
  "Киселев Евгений Алексеевич",
  "Кисин Евгений Игоревич",
  "Клепиковская Екатерина Дмитриевна",
  "Климарев Михаил Валерьевич",
  "Климов Антон Михайлович",
  "Климов Максим Евгеньевич",
  "Ковалев Алексей Андреевич",
  "Ковальченко Сергей Владимирович",
  "Ковин Виталий Сергеевич",
  "Козенко Андрей Дмитриевич",
  "Козловский Станислав Александрович",
  "Козырев Андрей Владимирович",
  "Козырев Михаил Натанович",
  "Колдобский Сергей Григорьевич",
  "Колезев Дмитрий Евгеньевич",
  "Колесников Андрей Владимирович",
  "Колмановский Илья Александрович",
  "Комелев Алексей Юрьевич",
  "Комин Михаил Олегович",
  "Комиссаров Станислав Андреевич",
  "Кондакова Саргылана Константиновна",
  "Конопелькин Антон Сергеевич",
  "Константинов Даниил Ильич",
  "Константинов Денис Владимирович",
  "Константинова Алла Михайловна",
  "Королёв Андрей Владимирович",
  "Костылева Полина Владимировна",
  "Косыгин Илья Евгеньевич",
  "Котляров Владимир Андреевич",
  "Котрикадзе Екатерина Бесикиевна",
  "Кочегин Евгений Сергеевич",
  "Кочесоков Мартин Хусенович",
  "Кочетков Игорь Викторович",
  "Кочкин Семен Александрович",
  "Крашенинников Федор Геннадиевич",
  "Кривенко Сергей Владимирович",
  "Кругликов Кирилл Игоревич",
  "Крутихин Михаил Иванович",
  "Куваев Олег Игоревич",
  "Кузахметов Максим Рафикович",
  "Кузьмин Николай Александрович",
  "Кузьмина Людмила Гавриловна",
  "Кукушкин Никита Андреевич",
  "Кунгуров Алексей Анатольевич",
  "Кураев Андрей Вячеславович",
  "Курбангалеева Фарида Рашидовна",
  "Курманакаев Анвар Мусабиевич",
  "Куршин Андрей Владимирович",
  "Куцылло Вероника Иосифовна",
  "Кучер Станислав Александрович",
  "Кушнарь Александр Александрович",
  "Лада-Русь Светлана Михайловна",
  "Лазарева Татьяна Юрьевна",
  "Латынина Юлия Леонидовна",
  "Латыпов Роберт Рамилевич",
  "Левшиц Николай Дмитриевич",
  "Лекманов Олег Андершанович",
  "Лешкевич Владислав Валерьевич",
  "Либеров Роман Александрович",
  "Липсиц Игорь Владимирович",
  "Лирник Антон Анатольевич",
  "Литвин Богдан Геннадьевич",
  "Литвинов Александр Сергеевич",
  "Литвинович Марина Алексеевна",
  "Лобанов Михаил Сергеевич",
  "Лойко Сергей Леонидович",
  "Лотарева Анастасия Александровна",
  "Лошак Андрей Борисович",
  "Лукьянова Елена Анатольевна",
  "Лукьянова Юлия Сергеевна",
  "Лученко Ксения Валерьевна",
  "Лушников Алексей Германович",
  "Лушникова Екатерина Евгеньевна",
  "Львов Андрей Генриевич",
  "Любарев Аркадий Ефимович",
  "Любимов Дмитрий Александрович",
  "Лютов Александр Иванович",
  "Маетная Елизавета Витальевна",
  "Макаревич Андрей Вадимович",
  "Макашенец Александр Юрьевич",
  "Максакова-Игенбергс Мария Петровна",
  "Малаховская Елена Владимировна",
  "Малкова Ирина Владимировна",
  "Малов Алексей Владимирович",
  "Мальгин Андрей Викторович",
  "Мальцев Вячеслав Вячеславович",
  "Манский Виталий Всеволодович",
  "Маняхин Петр Борисович",
  "Марголис Екатерина Леонидовна",
  "Маркелов Сергей Евгеньевич",
  "Мароховская Алеся Алексеевна",
  "Мартыненко Тимофей Сергеевич",
  "Мартынов Кирилл Константинович",
  "Маршенкулова Залина Хамидовна",
  "Матвеев Илья Александрович",
  "Матвеев Ян Андреевич",
  "Матвейченков Максим Владимирович",
  "Маяковская Екатерина Алексеевна",
  "Медведев Артем Павлович",
  "Медведев Сергей Александрович",
  "Медведев Сергей Юрьевич",
  "Мезерин Павел Владимирович",
  "Меньшиков Андрей Владимирович",
  "Милов Владимир Станиславович",
  "Минкин Александр Викторович",
  "Митрохин Николай Александрович",
  "Михнов-Вайтенко Григорий Александрович",
  "Монгайт Анна Викторовна",
  "Моргенштерн Алишер Тагирович",
  "Морев Андрей Зиновьевич",
  "Морозов Александр Олегович",
  "Муждабаев Айдер Иззетович",
  "Мунтян Павел Андреевич",
  "Мурадов Мурад Абдулгалимович",
  "Муратов Дмитрий Андреевич",
  "Мурзагулов Ростислав Рафкатович",
  "Набутов Кирилл Викторович",
  "Наки Майкл Сидней",
  "Намазбаева Татьяна Валерьевна",
  "Наринская Анна Анатольевна",
  "Невзлин Леонид Борисович",
  "Невзоров Александр Глебович",
  "Некрасов Дмитрий Александрович",
  "Низовцев Дмитрий Александрович",
  "Никандров Марат Игоревич",
  "Никульшина Вероника Юрьевна",
  "Новашов Андрей Валерьевич",
  "Новиков Илья Сергеевич",
  "Обухов Герман Викторович",
  "Олейник Владислав Александрович",
  "Оленичев Максим Владимирович",
  "Омбадыков Эрдни Басан",
  "Орешкин Дмитрий Борисович",
  "Орлов Олег Петрович",
  "Осетинская Елизавета Николаевна",
  "Осечкин Владимир Валерьевич",
  "Осипова Светлана Витальевна",
  "Осмоловский Анатолий Феликсович",
  "Осовцов Александр Авраамович",
  "Охотин Григорий Никитич",
  "Павлов Андрей Васильевич",
  "Павлов Иван Юрьевич",
  "Панюшкин Валерий Валерьевич",
  "Парамонова Юлия Борисовна",
  "Парменов Никита Владимирович",
  "Пархоменко Сергей Борисович",
  "Пастухов Владимир Борисович",
  "Пахалюк Константин Александрович",
  "Певчих Мария Константиновна",
  "Пелевина Наталья Владиславовна",
  "Перл Роман Александрович",
  "Петров Алексей Викторович",
  "Петров Николай Владимирович",
  "Петров Степан Юрьевич",
  "Пивоваров Алексей Владимирович",
  "Пивоваров Юрий Сергеевич",
  "Пигалкин Илья Валерьевич",
  "Пионтковский Андрей Андреевич",
  "Пирогова Хельга Вадимовна",
  "Пискунов Сергей Евгеньевич",
  "Плющев Александр Владимирович",
  "Подольская Ольга Валерьевна",
  "Покровский Максим Сергеевич",
  "Поливанова Александра Владимировна",
  "Полозов Николай Николаевич",
  "Понасенков Евгений Николаевич",
  "Пономарев Илья Владимирович",
  "Пономарев Лев Александрович",
  "Поночевный Игорь Васильевич",
  "Поперечный Данила Алексеевич",
  "Попова Алена Владимировна",
  "Постернак Алексей Евгеньевич",
  "Потапенко Дмитрий Валерьевич",
  "Преображенский Иван Сергеевич",
  "Продайвода Алексей Владимирович",
  "Прокашева Елена Владимировна",
  "Прокопенко Александра Сергеевна",
  "Прокопьева Светлана Владимировна",
  "Прохоров Вадим Юрьевич",
  "Прусикин Илья Владимирович",
  "Прянишников Алексей Александрович",
  "Пуркин Дмитрий Николаевич",
  "Пшеничная Анна Эдуардовна",
  "Пьяных Глеб Валентинович",
  "Радзинский Олег Эдвардович",
  "Раевский Владимир Евгеньевич",
  "Ракша Алексей Игоревич",
  "Рамазанова Земфира Талгатовна",
  "Распутин Ярослав Иванович",
  "Раткин Альберт Викторович",
  "Ратникова Валерия Евгеньевна",
  "Рачинский Ян Збигневич",
  "Резник Максим Львович",
  "Ривина Анна Валерьевна",
  "Рогов Кирилл Юрьевич",
  "Роднянский Александр Ефимович",
  "Рождественский Илья Дмитриевич",
  "Ройзман Евгений Вадимович",
  "Ромалийская Ирина Геннадьевна",
  "Романова Ольга Евгеньевна",
  "Роменский Владимир Андреевич",
  "Рубин Антон Борисович",
  "Рубин Михаил Аркадьевич",
  "Рувинский Владимир Владимирович",
  "Рудакова Диана Борисовна",
  "Рудой Андрей Владимирович",
  "Рыклин Александр Юрьевич",
  "Сабунаева Мария Леонидовна",
  "Савва Михаил Валентинович",
  "Савельев Александр Валерьевич",
  "Савицкая Людмила Алексеевна",
  "Свердлин Григорий Сергеевич",
  "Светов Михаил Владимирович",
  "Севец-Ермолина Наталья Федоровна",
  "Седов Кирилл Вадимович",
  "Семенов Алексей Владимирович",
  "Серегин Алексей Александрович",
  "Серенко Дарья Андреевна",
  "Сидельников Андрей Александрович",
  "Симонов Евгений Алексеевич",
  "Синдеева Наталья Владимировна",
  "Синеокая Юлия Вадимовна",
  "Сироткин Ярослав Николаевич",
  "Скворцова Елена Сергеевна",
  "Скобов Александр Валерьевич",
  "Слабых Игорь Игоревич",
  "Слепаков Семен Сергеевич",
  "Сливяк Владимир Владимирович",
  "Смагин Никита Анатольевич",
  "Смирнов Александр Александрович",
  "Смирнов Сергей Сергеевич",
  "Смольянинов Артур Сергеевич",
  "Снеговая Мария Владиславовна",
  "Соболев Николай Юрьевич",
  "Соболь Любовь Эдуардовна",
  "Соколов Антон Сергеевич",
  "Соколов Денис Владимирович",
  "Соколов Михаил Владимирович",
  "Соколов Никита Павлович",
  "Солдатов Андрей Алексеевич",
  "Соловей Валерий Дмитриевич",
  "Соловьева Елена Анатольевна",
  "Сонин Константин Исаакович",
  "Сотников Даниил Владимирович",
  "Сотникова Татьяна Александровна",
  "Спирин Дмитрий Александрович",
  "Становая Татьяна Анатольевна",
  "Степанов Олег Олегович",
  "Степанов Сергей Николаевич",
  "Сторожева Ирина Владимировна",
  "Ступин Евгений Викторович",
  "Суворкин Антон Владимирович",
  "Суляндзига Павел Васильевич",
  "Супер Роман Владимирович",
  "Сурначева Елизавета Дмитриевна",
  "Сусолкин Константин Александрович",
  "Суханов Алексей Станиславович",
  "Сухарев Дмитрий Вадимович",
  "Счастливая Дарья Владимировна",
  "Тагаева Лола Маджидовна",
  "Таратута Юлия Леонидовна",
  "Татулова Анастасия Анатольевна",
  "Телегина Наталия Геннадьевна",
  "Телин Федор Алексеевич",
  "Тимонов Михаил Леонидович",
  "Тимченко Галина Викторовна",
  "Тиньков Олег Юрьевич",
  "Тихонов Михаил Сергеевич",
  "Толоконникова Надежда Андреевна",
  "Толстой Святослав Георгиевич",
  "Ториев Магомед Идрисович",
  "Трескунов Семён Алексеевич",
  "Трещанин Дмитрий Евгеньевич",
  "Троицкий Артемий Кивович",
  "Трошин Сергей Александрович",
  "Троянова Яна Александровна",
  "Трудолюбов Максим Анатольевич",
  "Тютрин Иван Иванович",
  "Узаров Хасан Ганиевич",
  "Улицкая Людмила Евгеньевна",
  "Урушадзе Георгий Фридонович",
  "Усанова Олимпиада Валентиновна",
  "Устимов Антон Михайлович",
  "Уткин Федор Викторович",
  "Ухов Сергей Анатольевич",
  "Федоров Кирилл Владимирович",
  "Федоров Мирон Янович",
  "Федоров Юрий Евгеньевич",
  "Федоровых Арина Эдуардовна",
  "Фейгин Марк Захарович",
  "Фельдман Евгений Олегович",
  "Фельштинский Юрий Георгиевич",
  "Филимонов Андрей Викторович",
  "Филиппов Иван Борисович",
  "Фишман Михаил Владимирович",
  "Фохт-Бабушкина Елизавета Антоновна",
  "Фурсов Анатолий Владимирович",
  "Харатьян Кирилл Евгеньевич",
  "Харченко Вадим Михайлович",
  "Хашиг Инал Николаевич",
  "Хейкинен Дарья Дмитриевна",
  "Хисамова Регина Фаритовна",
  "Ходорковский Михаил Борисович",
  "Хржановский Илья Андреевич",
  "Цветкова Юлия Владимировна",
  "Цибирев Дмитрий Александрович",
  "Цимбалюк Роман Владимирович",
  "Цуканова Ольга Викторовна",
  "Чаниа Изида Терентьевна",
  "Чентемиров Георгий Ростиславович",
  "Черепанова Ксения Федоровна",
  "Черкасов Александр Владимирович",
  "Чернышев Дмитрий Александрович",
  "Чернышов Сергей Андреевич",
  "Чиков Павел Владимирович",
  "Чимаров Михаил Юрьевич",
  "Чирикова Евгения Сергеевна",
  "Чистякова Мария Владимировна",
  "Чичваркин Евгений Александрович",
  "Чуракова Ольга Владимировна",
  "Чхартишвили Григорий Шалвович",
  "Шаблинский Илья Георгиевич",
  "Шаведдинов Руслан Табризович",
  "Шадрина Татьяна Владимировна",
  "Шаинян Карен Багратович",
  "Шакиров Мумин Шакирович",
  "Шац Михаил Григорьевич",
  "Шведов Григорий Сергеевич",
  "Швец Юрий Борисович",
  "Шевченко Анастасия Нукзариевна",
  "Шеин Олег Васильевич",
  "Шейтельман Михаил",
  "Шелест Александр",
  "Шендерович Виктор Анатольевич",
  "Шепелин Илья Андреевич",
  "Ширяев Вячеслав Эдуардович",
  "Шихман Ирина Юрьевна",
  "Шишкин Михаил Павлович",
  "Шлейнов Роман Юрьевич",
  "Шлосберг Лев Маркович",
  "Шмагун Олеся Валентиновна",
  "Шмурнов Александр Иванович",
  "Шпак Александр Константинович",
  "Шпилькин Сергей Александрович",
  "Штефанов Александр Андреевич",
  "Шукаева Елена Викторовна",
  "Шульман Екатерина Михайловна",
  "Шуманов Илья Вячеславович",
  "Шуршев Александр Олегович",
  "Щербакова Ирина Лазаревна",
  "Эггерт Константин Петрович",
  "Эйдельман Тамара Натановна",
  "Эйдман Игорь Виленович",
  "Экслер Алексей Борисович",
  "Эппле Николай Владимирович",
  "Эткинд Александр Маркович",
  "Юдин Григорий Борисович",
  "Юсупов Идрис Гасан-Гусейнович",
  "Яганов Ибрагим Хасанбиевич",
  "Яковенко Игорь Александрович",
  "Яковина Иван Викторович",
  "Янковский Аркадий Эдуардович",
  "Ярмыш Кира Александровна",
  "Ярош Юлия Петровна",
  "Ясавеев Искэндэр Габдрахманович",
  "Яшин Илья Валерьевич"]

TOKEN = os.getenv("BOT_TOKEN")
if not TOKEN:
    raise ValueError("Не найден токен BOT_TOKEN в переменных окружения")

bot = Bot(token=TOKEN)
app = Flask(__name__)
dispatcher = Dispatcher(bot, None, workers=0)

def start(update: Update, context=None):
    update.message.reply_text("Здравствуйте! Меня создал Александр @kaimagic, самый лучший и самый красивый человек в этом мире. Чтобы помочь его суженой ряженой мармеладке Быковой Анне Дмитриевне сдать диплом. Отправьте мне Word-файл и я выделю имена иноагентов красным цветом.")

def handle_doc(update: Update, context=None):
    file = update.message.document.get_file()
    file_bytes = BytesIO()
    file.download(out=file_bytes)
    file_bytes.seek(0)

    doc = Document(file_bytes)

    for para in doc.paragraphs:
        original_text = para.text
        para.clear()  # Очищаем параграф, чтобы вручную вставить отформатированные куски

        i = 0
        while i < len(original_text):
            match_found = False
            for name in FOREIGN_AGENT_NAMES:
                if original_text[i:i+len(name)] == name:
                    run = para.add_run(name)
                    run.font.color.rgb = RGBColor(255, 0, 0)  # Красный цвет
                    i += len(name)
                    match_found = True
                    break
            if not match_found:
                run = para.add_run(original_text[i])
                i += 1

    output = BytesIO()
    doc.save(output)
    output.seek(0)

    update.message.reply_document(document=output, filename="Готовый файл.docx")

# Регистрируем обработчики
dispatcher.add_handler(CommandHandler("start", start))
dispatcher.add_handler(MessageHandler(Filters.document.mime_type("application/vnd.openxmlformats-officedocument.wordprocessingml.document"), handle_doc))

@app.route(f"/{TOKEN}", methods=["POST"])
def webhook():
    data = request.get_json(force=True)
    update = Update.de_json(data, bot)
    dispatcher.process_update(update)
    return "ok"

@app.route("/")
def index():
    return "Bot is running"

if __name__ == "__main__":
    port = int(os.environ.get("PORT", 5000))
    print(f"Starting app on port {port}")
    app.run(host="0.0.0.0", port=port)
